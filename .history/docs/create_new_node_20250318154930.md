# 创建新节点的步骤和注意事项

## 1. 节点定义
首先在 `src/data/operationNodes.ts` 中添加节点定义：
```typescript
{
  type: 'NewNodeName',  // 这个type要和后面组件名保持一致
  label: 'Display Name',
  description: 'Node Description',
  category: 'Medusa',  // 或其他类别
  expanded: true,      // 如果需要默认展开面板
  specs: {
    // 设备规格
  },
  parameters: [
    // 参数定义
  ],
  inputs: [
    // 输入定义
  ],
  outputs: [
    // 输出定义
  ],
  primitives: [
    // 原语定义
  ]
}
```

## 2. 组件创建
在对应类别目录下创建组件文件夹和相关文件：

### 2.1 目录结构
```
src/components/OperationNodes/[Category]/[NodeName]/
├── index.tsx        // 组件主文件
├── constants.ts     // 常量定义
└── styles.css       // 样式文件
```

### 2.2 组件实现方式选择
有两种实现方式：

1. 简单方式：直接使用 `createNodeComponent`
```typescript
// src/components/OperationNodes/index.tsx
export const NewNode = createNodeComponent('Category');
```

2. 自定义面板方式：创建完整的组件实现
```typescript
// src/components/OperationNodes/[Category]/[NodeName]/index.tsx
const NodePanel = ({ data }) => (
  // 面板实现
);

const NodeWrapper = (props) => {
  const BaseNode = createNodeComponent('Category');
  return (
    <div className="node-wrapper">
      <BaseNode {...props} />
      <NodePanel data={props.data} />
    </div>
  );
};

export const NewNode = NodeWrapper;
```

## 3. 组件注册
需要在多个地方注册新节点：

### 3.1 主入口文件
在 `src/components/OperationNodes/index.tsx` 中：
```typescript
// 1. 导出节点组件
export const NewNode = createNodeComponent('Category');

// 2. 添加到 nodeComponents
export const nodeComponents = {
  // ... 其他节点
  NewNode,
};
```

### 3.2 App组件
在 `src/App.tsx` 中：
```typescript
// 1. 导入组件
import { NewNode } from './components/OperationNodes';

// 2. 添加到 MemoizedNodes
const MemoizedNodes = {
  // ... 其他节点
  NewNode: memo(NewNode),
};
```

## 4. 常见错误和注意事项

1. **命名冲突**：
   - 如果有重名组件，需要使用不同的名称（如 `NewNode_1`）
   - 修改时需要同步修改：
     - 组件名称
     - `type` 字段
     - 导出名称
     - `MemoizedNodes` 中的键名

2. **路径问题**：
   - 导入 `createNodeComponent` 时要注意路径层级
   - 从组件目录到 `OperationNodes/index.tsx` 的相对路径要正确

3. **样式注意**：
   - 样式类名要避免冲突
   - 面板默认展开需要设置：
     - `expanded: true` 在节点定义中
     - `display: block` 在面板的 CSS 中

4. **组件导出顺序**：
   - 先定义基础组件
   - 再导出具体实现
   - 最后添加到 `nodeComponents` 对象中

## 5. 验证清单

- [ ] 节点定义已添加到 `operationNodes.ts`
- [ ] 组件文件结构完整（index.tsx, constants.ts, styles.css）
- [ ] 组件已在主入口文件正确导出
- [ ] 组件已添加到 `nodeComponents`
- [ ] 组件已添加到 `MemoizedNodes`
- [ ] 所有命名保持一致
- [ ] 所有导入路径正确
- [ ] 样式类名唯一
- [ ] 面板展开状态正确设置

## 6. 调试技巧

1. 如果节点不显示，检查：
   - 组件是否正确导出
   - 节点类型名称是否一致
   - `MemoizedNodes` 是否正确配置

2. 如果面板不展开，检查：
   - 节点定义中的 `expanded` 属性
   - CSS 中的 `display` 属性
   - 面板的 z-index 是否正确

3. 如果出现样式问题，检查：
   - CSS 文件是否正确导入
   - 样式类名是否有冲突
   - 样式优先级是否正确 
